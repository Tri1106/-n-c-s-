<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Qu·∫£n l√Ω tour</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f4f6f8;
        margin: 0;
      }
      header {
        background: #2e4357;
        color: white;
        padding: 20px;
        text-align: center;
      }
      nav {
        background: #34495e;
        padding: 10px 0;
      }
      nav ul {
        list-style: none;
        display: flex;
        justify-content: center;
        gap: 30px;
        margin: 0;
        padding: 0;
      }
      nav ul li,
      nav ul li a {
        color: white;
        font-weight: bold;
        text-decoration: none;
      }
      main {
        padding: 30px;
        max-width: 1200px;
        margin: auto;
      }
      h2 {
        text-align: center;
        color: #2c3e50;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        border-radius: 10px;
        overflow: hidden;
      }
      th,
      td {
        padding: 12px 15px;
        border-bottom: 1px solid #ddd;
        text-align: center;
      }
      th {
        background-color: #2980b9;
        color: white;
      }
      tr:hover {
        background-color: #f9f9f9;
      }
      .action-buttons button {
        padding: 6px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
        color: white;
        margin: 0 5px;
      }
      .edit-btn {
        background-color: #27ae60;
      }
      .delete-btn {
        background-color: #c0392b;
      }
      #editFormContainer {
        display: none;
        margin-top: 20px;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
      }
      #editFormContainer label {
        display: block;
        margin-bottom: 10px;
      }
      #editFormContainer input {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        box-sizing: border-box;
      }
      #editFormContainer button {
        margin-top: 10px;
        padding: 10px 15px;
        font-weight: bold;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      #editFormContainer .save-btn {
        background-color: #27ae60;
        color: white;
        margin-right: 10px;
      }
      #editFormContainer .cancel-btn {
        background-color: #c0392b;
        color: white;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Qu·∫£n tr·ªã vi√™n - Qu·∫£n l√Ω tour</h1>
      <nav>
        <ul>
          <li><a href="/user">üë• Qu·∫£n l√Ω t√†i kho·∫£n</a></li>
          <li><a href="/tours">üìÑ Qu·∫£n l√Ω tour</a></li>
          <li><a href="#">üíµ Doanh thu</a></li>
          <li><a href="#">üìä Th·ªëng k√™</a></li>
          <li><a href="/admin-bookings.html">üßæ Qu·∫£n l√Ω ƒë∆°n ƒë·∫∑t</a></li>
          <li><a href="/admin-dashboard">Quay L·∫°i</a></li>
        </ul>
      </nav>
    </header>

    <main>
      <h2>Danh s√°ch Tour</h2>
      <table id="tourList">
        <thead>
          <tr>
            <th>T√™n Tour</th>
            <th>ƒêi·ªÉm ƒê·∫øn</th>
            <th>Gi√° Tour</th>
            <th>H√¨nh ·∫¢nh</th>
            <th>S·ªë ch·ªó</th>
            <th>H√†nh ƒê·ªông</th>
          </tr>
        </thead>
        <tbody id="tourTableBody">
          <!-- D·ªØ li·ªáu tour s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y th√¥ng qua JavaScript -->
        </tbody>
      </table>

      <div id="editFormContainer">
        <h3>S·ª≠a th√¥ng tin Tour</h3>
        <form id="editTourForm">
          <input type="hidden" id="editTourID" />
          <label>
            T√™n Tour:
            <input type="text" id="editTourName" required />
          </label>
          <label>
            ƒêi·ªÉm ƒê·∫øn:
            <input type="text" id="editDestination" required />
          </label>
          <label>
            Gi√° Tour:
            <input type="number" id="editPrice" required />
          </label>
          <label>
            H√¨nh ·∫¢nh (URL):
            <input type="text" id="editImageURL" required />
          </label>
          <label>
            S·ªë ch·ªó:
            <input type="number" id="editSeats" required />
          </label>
          <button type="submit" class="save-btn">L∆∞u thay ƒë·ªïi</button>
          <button type="button" class="cancel-btn" onclick="hideEditForm()">H·ªßy</button>
        </form>
      </div>
    </main>

    <script>
      async function fetchTours() {
        try {
          const response = await fetch('/tours/data');
          const tours = await response.json();
          const tbody = document.getElementById('tourTableBody');
          tbody.innerHTML = '';

          tours.forEach(tour => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${tour.TourName}</td>
              <td>${tour.Destination}</td>
              <td>${tour.Price}</td>
              <td><img src="${tour.ImageURL}" alt="Tour Image" width="100"/></td>
              <td>${tour.SoCho}</td>
              <td class="action-buttons">
                <button class="edit-btn" onclick="showEditForm('${tour.TourName}', '${tour.Destination}', ${tour.Price}, '${tour.ImageURL}', ${tour.SoCho})">S·ª≠a</button>
                <button class="delete-btn" onclick="deleteTour('${tour.TourName}')">X√≥a</button>
              </td>
            `;
            tbody.appendChild(tr);
          });
        } catch (error) {
          console.error('‚ùå L·ªói khi l·∫•y danh s√°ch tours:', error);
        }
      }

      function showEditForm(tourName, destination, price, imageURL, seats) {
        document.getElementById('editTourID').value = tourName;
        document.getElementById('editTourName').value = tourName;
        document.getElementById('editDestination').value = destination;
        document.getElementById('editPrice').value = price;
        document.getElementById('editImageURL').value = imageURL;
        document.getElementById('editSeats').value = seats;
        document.getElementById('editFormContainer').style.display = 'block';
      }

      function hideEditForm() {
        document.getElementById('editFormContainer').style.display = 'none';
      }

      document.getElementById('editTourForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const tourID = document.getElementById('editTourID').value;
        const updatedTour = {
          TourName: document.getElementById('editTourName').value,
          Destination: document.getElementById('editDestination').value,
          Price: parseFloat(document.getElementById('editPrice').value),
          ImageURL: document.getElementById('editImageURL').value,
          SoCho: parseInt(document.getElementById('editSeats').value),
        };

        try {
          const response = await fetch(`/tours/${encodeURIComponent(tourID)}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(updatedTour),
          });
          const result = await response.json();
          if (result.success) {
            alert('C·∫≠p nh·∫≠t tour th√†nh c√¥ng!');
            hideEditForm();
            fetchTours();
          } else {
            alert('C·∫≠p nh·∫≠t tour th·∫•t b·∫°i: ' + result.message);
          }
        } catch (error) {
          alert('L·ªói khi c·∫≠p nh·∫≠t tour.');
          console.error(error);
        }
      });

      async function deleteTour(tourName) {
        if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a tour n√†y?')) return;

        try {
          const response = await fetch(`/tours/${encodeURIComponent(tourName)}`, {
            method: 'DELETE',
          });
          const result = await response.json();
          if (result.success) {
            alert('X√≥a tour th√†nh c√¥ng!');
            fetchTours();
          } else {
            alert('X√≥a tour th·∫•t b·∫°i: ' + result.message);
          }
        } catch (error) {
          alert('L·ªói khi x√≥a tour.');
          console.error(error);
        }
      }

      fetchTours();
    </script>
  </body>
</html>

<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Provider Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="flex h-screen bg-gray-100">
    <!-- Sidebar -->
    <aside class="w-64 bg-white shadow-md p-4">
      <h2 class="text-2xl font-bold mb-6 text-blue-600">Provider Panel</h2>
      <nav class="flex flex-col gap-4">
        <button
          class="tab-btn text-left hover:text-blue-600"
          data-tab="addTour"
        >
          â• ThÃªm Tour
        </button>
        <button
          class="tab-btn text-left hover:text-blue-600"
          data-tab="manageTour"
        >
          âœï¸ Quáº£n lÃ½ Tour
        </button>
        <button
          class="tab-btn text-left hover:text-blue-600"
          data-tab="viewOrders"
        >
          ğŸ§¾ Xem ÄÆ¡n Äáº·t
        </button>
        <button
          class="tab-btn text-left hover:text-blue-600"
          data-tab="confirmTour"
        >
          ğŸ“¥ XÃ¡c Nháº­n Tour
        </button>
        <button
          class="tab-btn text-left hover:text-blue-600"
          data-tab="manageServices"
        >
          ğŸ§³ Quáº£n lÃ½ KS/VÃ© MB
        </button>
        <a class="text-left hover:text-blue-600" href="/home">ÄÄƒng Xuáº¥t</a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-6 overflow-y-auto">
      <!-- ThÃªm Tour -->
      <section id="addTour" class="tab-content">
        <h2 class="text-xl font-bold mb-4">â• ThÃªm Tour Má»›i</h2>
        <form
          id="addTourForm"
          class="grid grid-cols-1 md:grid-cols-2 gap-4"
          enctype="multipart/form-data"
          method="POST"
        >
          <input
            type="text"
            name="tourName"
            placeholder="TÃªn tour"
            class="p-2 border rounded"
            required
          />
          <input
            type="text"
            name="destination"
            placeholder="Äiá»ƒm Ä‘áº¿n"
            class="p-2 border rounded"
            required
          />
          <input
            type="number"
            name="price"
            placeholder="GiÃ¡"
            class="p-2 border rounded"
            required
          />
          <input
            type="number"
            name="seats"
            placeholder="Sá»‘ chá»—"
            class="p-2 border rounded"
            required
          />
          <input
            type="file"
            name="tourImage"
            accept="image/*"
            class="col-span-1 md:col-span-2"
            required
          />
          <button
            type="submit"
            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded col-span-1 md:col-span-2"
          >
            ThÃªm Tour
          </button>
          <p
            id="tourMessage"
            class="hidden col-span-1 md:col-span-2 font-semibold"
          ></p>
        </form>
      </section>

      <!-- Quáº£n lÃ½ Tour -->
      <section id="manageTour" class="tab-content hidden">
        <h2 class="text-2xl font-bold mb-4">âœï¸ Quáº£n lÃ½ Tour</h2>
        <div class="overflow-x-auto">
          <table class="min-w-full border">
            <thead class="bg-gray-100">
              <tr>
                <th class="px-4 py-2 border">TÃªn Tour</th>
                <th class="px-4 py-2 border">Äiá»ƒm Ä‘áº¿n</th>
                <th class="px-4 py-2 border">GiÃ¡</th>
                <th class="px-4 py-2 border">Sá»‘ chá»—</th>
                <th class="px-4 py-2 border">áº¢nh</th>
                <th class="px-4 py-2 border">HÃ nh Ä‘á»™ng</th>
              </tr>
            </thead>
            <tbody id="tourList" class="text-center">
              <!-- Tour sáº½ Ä‘Æ°á»£c render báº±ng JS -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- Modal chá»‰nh sá»­a -->
      <div
        id="editTourModal"
        class="fixed inset-0 bg-black bg-opacity-40 hidden items-center justify-center z-50"
      >
        <div class="bg-white p-6 rounded-lg w-[400px]">
          <h2 class="text-xl font-bold mb-4">âœï¸ Chá»‰nh sá»­a Tour</h2>
          <form id="editTourForm" class="flex flex-col gap-4">
            <input
              type="text"
              id="editTourName"
              placeholder="TÃªn tour"
              class="p-2 border rounded"
              required
            />
            <input
              type="text"
              id="editDestination"
              placeholder="Äiá»ƒm Ä‘áº¿n"
              class="p-2 border rounded"
              required
            />
            <input
              type="number"
              id="editPrice"
              placeholder="GiÃ¡"
              class="p-2 border rounded"
              required
            />
            <input
              type="number"
              id="editSeats"
              placeholder="Sá»‘ chá»—"
              class="p-2 border rounded"
              required
            />
            <div class="flex justify-end gap-2">
              <button
                type="button"
                id="cancelEdit"
                class="bg-gray-400 hover:bg-gray-500 text-white py-1 px-4 rounded"
              >
                Há»§y
              </button>
              <button
                type="submit"
                class="bg-blue-500 hover:bg-blue-600 text-white py-1 px-4 rounded"
              >
                LÆ°u
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- CÃ¡c tab khÃ¡c -->
      <section id="viewOrders" class="tab-content hidden">
        <h2 class="text-xl font-bold mb-4">ğŸ§¾ Xem ÄÆ¡n Äáº·t</h2>
        <p>Danh sÃ¡ch Ä‘Æ¡n Ä‘áº·t tour.</p>
      </section>

      <section id="confirmTour" class="tab-content hidden">
        <h2 class="text-xl font-bold mb-4">ğŸ“¥ XÃ¡c Nháº­n Tour</h2>
        <p>XÃ¡c nháº­n thá»§ cÃ´ng Ä‘Æ¡n Ä‘áº·t tour.</p>
      </section>

      <section id="manageServices" class="tab-content hidden">
        <h2 class="text-xl font-bold mb-4">
          ğŸ§³ Quáº£n lÃ½ KhÃ¡ch sáº¡n / VÃ© mÃ¡y bay
        </h2>

        <!-- Tabs ná»™i bá»™ -->
        <div class="flex gap-4 mb-4">
          <button
            class="sub-tab-btn bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded"
            data-subtab="manageHotels"
          >
            ğŸ¨ KhÃ¡ch sáº¡n
          </button>
          <button
            class="sub-tab-btn bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded"
            data-subtab="manageFlights"
          >
            âœˆï¸ VÃ© mÃ¡y bay
          </button>
        </div>

        <!-- Quáº£n lÃ½ khÃ¡ch sáº¡n -->
        <div id="manageHotels" class="sub-tab hidden">
          <form
            id="hotelForm"
            class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6"
          >
            <input
              type="text"
              name="hotelName"
              placeholder="TÃªn khÃ¡ch sáº¡n"
              class="p-2 border rounded"
              required
            />
            <input
              type="text"
              name="location"
              placeholder="Vá»‹ trÃ­"
              class="p-2 border rounded"
              required
            />
            <input
              type="number"
              name="pricePerNight"
              placeholder="GiÃ¡/Ä‘Ãªm"
              class="p-2 border rounded"
              required
            />
            <input
              type="file"
              name="hotelImage"
              accept="image/*"
              class="col-span-1 md:col-span-2"
              required
            />
            <button
              type="submit"
              class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded col-span-1 md:col-span-2"
            >
            
              â• ThÃªm KhÃ¡ch sáº¡n
            </button>
          </form>
          <div id="hotelList" class="space-y-2"></div>
        </div>

        <!-- Quáº£n lÃ½ vÃ© mÃ¡y bay -->
        <div id="manageFlights" class="sub-tab hidden">
          <form
            id="flightForm"
            class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6"
          >
            <input
              type="text"
              name="airline"
              placeholder="HÃ£ng bay"
              class="p-2 border rounded"
              required
            />
            <input
              type="text"
              name="fromTo"
              placeholder="Äiá»ƒm Ä‘i - Ä‘áº¿n"
              class="p-2 border rounded"
              required
            />
            <input
              type="number"
              name="flightPrice"
              placeholder="GiÃ¡ vÃ©"
              class="p-2 border rounded"
              required
            />
            <input
              type="datetime-local"
              name="departTime"
              class="p-2 border rounded"
              required
            />
            <button
              type="submit"
              class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded col-span-1 md:col-span-2"
            >
              â• ThÃªm VÃ© mÃ¡y bay
            </button>
          </form>
          <div id="flightList" class="space-y-2"></div>
        </div>
      </section>
    </main>

    <!-- Script -->
    <script>
      let selectedTourID = null;

      // Chuyá»ƒn tab
      document.querySelectorAll(".tab-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          const tab = btn.dataset.tab;
          document
            .querySelectorAll(".tab-content")
            .forEach((sec) => sec.classList.add("hidden"));
          document.getElementById(tab).classList.remove("hidden");
        });
      });

      // ThÃªm Tour
      document
        .getElementById("addTourForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const formData = new FormData(e.target);
          const messageBox = document.getElementById("tourMessage");

          try {
            const res = await fetch("/provider/add-tour", {
              method: "POST",
              body: formData,
            });

            const text = await res.text();
            console.log(text);

            messageBox.classList.remove("hidden");
            if (res.ok) {
              messageBox.innerText = "âœ… ThÃªm tour thÃ nh cÃ´ng!";
              messageBox.className =
                "text-green-600 font-semibold col-span-1 md:col-span-2";
              e.target.reset();
              fetchTours(); // Load láº¡i danh sÃ¡ch
            } else {
              messageBox.innerText = "âŒ ThÃªm tour tháº¥t báº¡i.";
              messageBox.className =
                "text-red-600 font-semibold col-span-1 md:col-span-2";
            }
          } catch (error) {
            console.error(error);
            messageBox.innerText = "âŒ KhÃ´ng thá»ƒ káº¿t ná»‘i server.";
            messageBox.className =
              "text-red-600 font-semibold col-span-1 md:col-span-2";
          }
        });

      // Load danh sÃ¡ch tour
      async function fetchTours() {
        try {
          const res = await fetch("/provider/tours");
          const tours = await res.json();
          const tourList = document.getElementById("tourList");
          tourList.innerHTML = "";

          tours.forEach((tour) => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td class="border px-4 py-2">${tour.TourName}</td>
              <td class="border px-4 py-2">${tour.Destination}</td>
              <td class="border px-4 py-2">${tour.Price}</td>
              <td class="border px-4 py-2">${tour.SoCho}</td>
              <td class="border px-4 py-2">
                <img src="${tour.ImageURL}" alt="Tour Image" class="w-16 h-16 object-cover rounded">
              </td>
              <td class="border px-4 py-2">
                <button class="edit-tour-btn bg-yellow-500 hover:bg-yellow-600 text-white py-1 px-2 rounded mr-2" data-id="${tour.TourID}">Chá»‰nh sá»­a</button>
                <button class="delete-tour-btn bg-red-500 hover:bg-red-600 text-white py-1 px-2 rounded" data-id="${tour.TourID}">XÃ³a</button>
              </td>
            `;
            tourList.appendChild(row);
          });
        } catch (error) {
          console.error("Lá»—i khi load tour:", error);
        }
      }
      fetchTours();

      // Chá»‰nh sá»­a tour
      document.addEventListener("click", (e) => {
        if (e.target.classList.contains("edit-tour-btn")) {
          selectedTourID = e.target.dataset.id;
          const row = e.target.closest("tr");
          document.getElementById("editTourName").value =
            row.children[0].innerText;
          document.getElementById("editDestination").value =
            row.children[1].innerText;
          document.getElementById("editPrice").value =
            row.children[2].innerText;
          document.getElementById("editSeats").value =
            row.children[3].innerText;
          document.getElementById("editTourModal").classList.remove("hidden");
        }
      });

      document.getElementById("cancelEdit").addEventListener("click", () => {
        document.getElementById("editTourModal").classList.add("hidden");
      });

      document
        .getElementById("editTourForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          try {
            const res = await fetch(`/provider/edit-tour/${selectedTourID}`, {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                tourName: document.getElementById("editTourName").value,
                destination: document.getElementById("editDestination").value,
                price: document.getElementById("editPrice").value,
                seats: document.getElementById("editSeats").value,
              }),
            });

            const text = await res.text();
            console.log(text);

            if (res.ok) {
              alert("âœ… Cáº­p nháº­t thÃ nh cÃ´ng!");
              document.getElementById("editTourModal").classList.add("hidden");
              fetchTours();
            } else {
              alert("âŒ KhÃ´ng thá»ƒ cáº­p nháº­t tour.");
            }
          } catch (err) {
            console.error("Lá»—i chá»‰nh sá»­a tour:", err);
          }
        });

      // XÃ³a tour
      document.addEventListener("click", async (e) => {
        if (e.target.classList.contains("delete-tour-btn")) {
          const id = e.target.dataset.id;
          if (confirm("Báº¡n cháº¯c cháº¯n muá»‘n xÃ³a tour nÃ y?")) {
            try {
              const res = await fetch(`/provider/delete-tour/${id}`, {
                method: "DELETE",
              });
              const text = await res.text();
              console.log(text);

              if (res.ok) {
                alert("ÄÃ£ xÃ³a thÃ nh cÃ´ng!");
                fetchTours();
              } else {
                alert("âŒ XÃ³a tháº¥t báº¡i.");
              }
            } catch (error) {
              console.error("Lá»—i khi xÃ³a:", error);
            }
          }
        }
      });

      document.querySelectorAll(".sub-tab-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          document
            .querySelectorAll(".sub-tab")
            .forEach((tab) => tab.classList.add("hidden"));
          const id = btn.dataset.subtab;
          document.getElementById(id).classList.remove("hidden");
        });
      });

      // Gá»­i khÃ¡ch sáº¡n
      document
        .getElementById("hotelForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const formData = new FormData(e.target);
          try {
            const res = await fetch("/provider/add-hotel", {
              method: "POST",
              body: formData,
            });
            const result = await res.text();
            alert(result);
            e.target.reset();
          } catch (err) {
            console.error(err);
            alert("âŒ Lá»—i khi thÃªm khÃ¡ch sáº¡n.");
          }
        });

      // Gá»­i vÃ© mÃ¡y bay
      document
        .getElementById("flightForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const formData = new FormData(e.target);
          try {
            const res = await fetch("/provider/add-flight", {
              method: "POST",
              body: formData,
            });
            const result = await res.text();
            alert(result);
            e.target.reset();
          } catch (err) {
            console.error(err);
            alert("âŒ Lá»—i khi thÃªm vÃ© mÃ¡y bay.");
          }
        });
    </script>
  </body>
</html>

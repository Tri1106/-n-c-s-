<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Provider Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="flex h-screen bg-gray-100">
    <!-- Sidebar -->
    <aside class="w-64 bg-white shadow-md p-4">
      <h2 class="text-2xl font-bold mb-6 text-blue-600">Provider Panel</h2>
      <nav class="flex flex-col gap-4">
        <button
          class="tab-btn text-left text-gray-700 hover:text-blue-600"
          data-tab="addTour"
        >
          ➕ Thêm Tour
        </button>
        <button
          class="tab-btn text-left text-gray-700 hover:text-blue-600"
          data-tab="manageTour"
        >
          ✏️ Quản lý Tour
        </button>
        <button
          class="tab-btn text-left text-gray-700 hover:text-blue-600"
          data-tab="viewOrders"
        >
          🧾 Xem Đơn Đặt
        </button>
        <button
          class="tab-btn text-left text-gray-700 hover:text-blue-600"
          data-tab="confirmTour"
        >
          📥 Xác Nhận Tour
        </button>
        <button
          class="tab-btn text-left text-gray-700 hover:text-blue-600"
          data-tab="manageServices"
        >
          🧳 Quản lý KS / Vé MB
        </button>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-6 overflow-y-auto">
      <!-- Thêm Tour -->
      <section id="addTour" class="tab-content">
        <h2 class="text-xl font-bold mb-4">➕ Thêm Tour Mới</h2>

        <form
          id="addTourForm"
          class="grid grid-cols-1 md:grid-cols-2 gap-4"
          enctype="multipart/form-data"
          method="POST"
        >
          <input
            type="text"
            name="tourName"
            placeholder="Tên tour"
            class="p-2 border rounded"
            required
          />
          <input
            type="text"
            name="destination"
            placeholder="Điểm đến"
            class="p-2 border rounded"
            required
          />
          <input
            type="number"
            name="price"
            placeholder="Giá"
            class="p-2 border rounded"
            required
          />
          <input
            type="number"
            name="seats"
            placeholder="Số chỗ"
            class="p-2 border rounded"
            required
          />
          <input type="file" name="tourImage" accept="image/*" required />

          <!-- providerID sẽ được gửi từ frontend -->
          <input
            type="hidden"
            name="providerID"
            value="providerID_value_from_session_or_authentication"
          />

          <button
            type="submit"
            class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 col-span-1 md:col-span-2"
          >
            Thêm Tour
          </button>

          <p
            id="tourMessage"
            class="col-span-1 md:col-span-2 font-semibold hidden"
          ></p>
        </form>
      </section>

      <!-- Quản lý Tour -->
      <section id="manageTour" class="tab-content hidden">
        <h2 class="text-xl font-bold mb-4">✏️ Quản lý Tour</h2>
        <p>
          Danh sách tour sẽ được hiển thị ở đây với nút chỉnh sửa, ẩn/hiện, cập
          nhật số chỗ còn lại.
        </p>
      </section>

      <!-- Xem đơn đặt -->
      <section id="viewOrders" class="tab-content hidden">
        <h2 class="text-xl font-bold mb-4">🧾 Xem Đơn Đặt</h2>
        <p>Hiển thị các đơn hàng/tour đã được người dùng đặt.</p>
      </section>

      <!-- Xác nhận tour -->
      <section id="confirmTour" class="tab-content hidden">
        <h2 class="text-xl font-bold mb-4">📥 Xác Nhận Tour</h2>
        <p>Gửi xác nhận thủ công đến khách đặt nếu cần.</p>
      </section>

      <!-- Quản lý KS / Vé MB -->
      <section id="manageServices" class="tab-content hidden">
        <h2 class="text-xl font-bold mb-4">
          🧳 Quản lý Khách sạn / Vé Máy Bay
        </h2>
        <p>Cho phép thêm, chỉnh sửa khách sạn hoặc vé máy bay đi kèm tour.</p>
      </section>
    </main>

    <!-- Script -->
    <script>
      // Đổi tab
      document.querySelectorAll(".tab-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          const tab = btn.getAttribute("data-tab");
          document
            .querySelectorAll(".tab-content")
            .forEach((el) => el.classList.add("hidden"));
          document.getElementById(tab).classList.remove("hidden");
        });
      });

      // Submit Thêm Tour
      document
        .getElementById("addTourForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const form = e.target;
          const formData = new FormData(form);
          const messageBox = document.getElementById("tourMessage");

          try {
            const res = await fetch("/provider/add-tour", {
              method: "POST",
              body: formData,
            });

            const text = await res.text();
            console.log("Server trả về:", text);

            messageBox.classList.remove("hidden");

            if (res.ok) {
              messageBox.innerText = "✅ Tour đã được thêm thành công!";
              messageBox.classList.remove("text-red-600");
              messageBox.classList.add("text-green-600");
              form.reset();
            } else {
              messageBox.innerText = "❌ Thêm tour thất bại!";
              messageBox.classList.remove("text-green-600");
              messageBox.classList.add("text-red-600");
            }
          } catch (err) {
            console.error("Lỗi fetch:", err);
            messageBox.innerText = "❌ Không thể kết nối tới server.";
            messageBox.classList.remove("text-green-600");
            messageBox.classList.add("text-red-600");
            messageBox.classList.remove("hidden");
          }
        });
    </script>
  </body>
</html>

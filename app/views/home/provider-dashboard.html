<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Provider Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="flex h-screen bg-gray-100">
    <!-- Sidebar -->
    <aside class="w-64 bg-white shadow-md p-4">
      <h2 class="text-2xl font-bold mb-6 text-blue-600">Provider Panel</h2>
      <nav class="flex flex-col gap-4">
        <button
          class="tab-btn text-left hover:text-blue-600"
          data-tab="addTour"
        >
          ‚ûï Th√™m Tour
        </button>
        <button
          class="tab-btn text-left hover:text-blue-600"
          data-tab="manageTour"
        >
          ‚úèÔ∏è Qu·∫£n l√Ω Tour
        </button>
        <button
          class="tab-btn text-left hover:text-blue-600"
          data-tab="viewOrders"
        >
          üßæ Xem ƒê∆°n ƒê·∫∑t
        </button>
        <button
          class="tab-btn text-left hover:text-blue-600"
          data-tab="confirmTour"
        >
          üì• X√°c Nh·∫≠n Tour
        </button>
        <button
          class="tab-btn text-left hover:text-blue-600"
          data-tab="manageServices"
        >
          üß≥ Qu·∫£n l√Ω KS/V√© MB
        </button>
        <a class="text-left hover:text-blue-600" href="/home">ƒêƒÉng Xu·∫•t</a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-6 overflow-y-auto">
      <!-- Th√™m Tour -->
      <section id="addTour" class="tab-content">
        <h2 class="text-xl font-bold mb-4">‚ûï Th√™m Tour M·ªõi</h2>
        <form
          id="addTourForm"
          class="grid grid-cols-1 md:grid-cols-2 gap-4"
          enctype="multipart/form-data"
          method="POST"
        >
          <input
            type="text"
            name="tourName"
            placeholder="T√™n tour"
            class="p-2 border rounded"
            required
          />
          <input
            type="text"
            name="destination"
            placeholder="ƒêi·ªÉm ƒë·∫øn"
            class="p-2 border rounded"
            required
          />
          <input
            type="number"
            name="price"
            placeholder="Gi√°"
            class="p-2 border rounded"
            required
          />
          <input
            type="number"
            name="seats"
            placeholder="S·ªë ch·ªó"
            class="p-2 border rounded"
            required
          />
          <input
            type="text"
            name="diemThamQuan"
            placeholder="ƒêi·ªÉm tham quan"
            class="p-2 border rounded"
          />
          <input
            type="text"
            name="amThuc"
            placeholder="·∫®m th·ª±c"
            class="p-2 border rounded"
          />
          <input
            type="text"
            name="doiTuongThichHop"
            placeholder="ƒê·ªëi t∆∞·ª£ng th√≠ch h·ª£p"
            class="p-2 border rounded"
          />
          <input
            type="text"
            name="thoiGianLyTuong"
            placeholder="Th·ªùi gian l√Ω t∆∞·ªüng"
            class="p-2 border rounded"
          />
          <input
            type="text"
            name="phuongTien"
            placeholder="Ph∆∞∆°ng ti·ªán"
            class="p-2 border rounded"
          />
          <input
            type="text"
            name="khuyenMai"
            placeholder="Khuy·∫øn m√£i"
            class="p-2 border rounded"
          />
          <input
            type="file"
            name="tourImage"
            accept="image/*"
            class="col-span-1 md:col-span-2"
            required
          />
          <button
            type="submit"
            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded col-span-1 md:col-span-2"
          >
            Th√™m Tour
          </button>
          <p
            id="tourMessage"
            class="hidden col-span-1 md:col-span-2 font-semibold"
          ></p>
        </form>
      </section>

      <!-- Qu·∫£n l√Ω Tour -->
      <section id="manageTour" class="tab-content hidden">
        <h2 class="text-2xl font-bold mb-4">‚úèÔ∏è Qu·∫£n l√Ω Tour</h2>
        <div class="overflow-x-auto">
          <table class="min-w-full border">
            <thead class="bg-gray-100">
              <tr>
                <th class="px-4 py-2 border">T√™n Tour</th>
                <th class="px-4 py-2 border">ƒêi·ªÉm ƒë·∫øn</th>
                <th class="px-4 py-2 border">Gi√°</th>
                <th class="px-4 py-2 border">S·ªë ch·ªó</th>
                <th class="px-4 py-2 border">·∫¢nh</th>
                <th class="px-4 py-2 border">H√†nh ƒë·ªông</th>
              </tr>
            </thead>
            <tbody id="tourList" class="text-center">
              <!-- Tour s·∫Ω ƒë∆∞·ª£c render b·∫±ng JS -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- Modal ch·ªânh s·ª≠a -->
      <div
        id="editTourModal"
        class="fixed inset-0 bg-black bg-opacity-40 hidden items-center justify-center z-50"
      >
        <div class="bg-white p-6 rounded-lg w-[400px]">
          <h2 class="text-xl font-bold mb-4">‚úèÔ∏è Ch·ªânh s·ª≠a Tour</h2>
          <form id="editTourForm" class="flex flex-col gap-4">
          <input
            type="text"
            id="editTourName"
            placeholder="T√™n tour"
            class="p-2 border rounded"
            required
          />
          <input
            type="text"
            id="editDestination"
            placeholder="ƒêi·ªÉm ƒë·∫øn"
            class="p-2 border rounded"
            required
          />
          <input
            type="number"
            id="editPrice"
            placeholder="Gi√°"
            class="p-2 border rounded"
            required
          />
          <input
            type="number"
            id="editSeats"
            placeholder="S·ªë ch·ªó"
            class="p-2 border rounded"
            required
          />
          <input
            type="text"
            id="editDiemThamQuan"
            placeholder="ƒêi·ªÉm tham quan"
            class="p-2 border rounded"
          />
          <input
            type="text"
            id="editAmThuc"
            placeholder="·∫®m th·ª±c"
            class="p-2 border rounded"
          />
          <input
            type="text"
            id="editDoiTuongThichHop"
            placeholder="ƒê·ªëi t∆∞·ª£ng th√≠ch h·ª£p"
            class="p-2 border rounded"
          />
          <input
            type="text"
            id="editThoiGianLyTuong"
            placeholder="Th·ªùi gian l√Ω t∆∞·ªüng"
            class="p-2 border rounded"
          />
          <input
            type="text"
            id="editPhuongTien"
            placeholder="Ph∆∞∆°ng ti·ªán"
            class="p-2 border rounded"
          />
          <input
            type="text"
            id="editKhuyenMai"
            placeholder="Khuy·∫øn m√£i"
            class="p-2 border rounded"
          />
          <div class="flex justify-end gap-2">
            <button
              type="button"
              id="cancelEdit"
              class="bg-gray-400 hover:bg-gray-500 text-white py-1 px-4 rounded"
            >
              H·ªßy
            </button>
            <button
              type="submit"
              class="bg-blue-500 hover:bg-blue-600 text-white py-1 px-4 rounded"
            >
              L∆∞u
            </button>
          </div>
        </form>
        </div>
      </div>

      <!-- C√°c tab kh√°c -->
      <section id="viewOrders" class="tab-content hidden">
        <h2 class="text-xl font-bold mb-4">üßæ Xem ƒê∆°n ƒê·∫∑t</h2>
        <p>Danh s√°ch ƒë∆°n ƒë·∫∑t tour.</p>
      </section>

      <section id="confirmTour" class="tab-content hidden">
        <h2 class="text-xl font-bold mb-4">üì• X√°c Nh·∫≠n Tour</h2>
        <p>X√°c nh·∫≠n th·ªß c√¥ng ƒë∆°n ƒë·∫∑t tour.</p>
      </section>

      <section id="manageServices" class="tab-content hidden">
        <h2 class="text-xl font-bold mb-4">
          üß≥ Qu·∫£n l√Ω Kh√°ch s·∫°n / V√© m√°y bay
        </h2>

        <!-- Tabs n·ªôi b·ªô -->
        <div class="flex gap-4 mb-4">
          <button
            class="sub-tab-btn bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded"
            data-subtab="manageHotels"
          >
            üè® Kh√°ch s·∫°n
          </button>
          <button
            class="sub-tab-btn bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded"
            data-subtab="manageFlights"
          >
            ‚úàÔ∏è V√© m√°y bay
          </button>
        </div>

        <!-- Qu·∫£n l√Ω kh√°ch s·∫°n -->
        <div id="manageHotels" class="sub-tab hidden">
        <form
          id="hotelForm"
          class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6"
        >
          <select
            name="tourID"
            id="hotelTourSelect"
            class="p-2 border rounded"
            required
          >
            <option value="">Ch·ªçn Tour</option>
          </select>
          <input
            type="text"
            name="hotelName"
            placeholder="T√™n kh√°ch s·∫°n"
            class="p-2 border rounded"
            required
          />
          <input
            type="text"
            name="location"
            placeholder="V·ªã tr√≠"
            class="p-2 border rounded"
            required
          />
          <input
            type="number"
            name="pricePerNight"
            placeholder="Gi√°/ƒë√™m"
            class="p-2 border rounded"
            required
          />
          <input
            type="file"
            name="hotelImage"
            accept="image/*"
            class="col-span-1 md:col-span-2"
            required
          />
          <button
            type="submit"
            class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded col-span-1 md:col-span-2"
          >
          
            ‚ûï Th√™m Kh√°ch s·∫°n
          </button>
        </form>
        <div id="hotelList" class="space-y-2"></div>
        </div>

        <!-- Qu·∫£n l√Ω v√© m√°y bay -->
        <div id="manageFlights" class="sub-tab hidden">
          <form
          id="flightForm"
          class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6"
        >
          <select
            name="tourID"
            id="flightTourSelect"
            class="p-2 border rounded"
            required
          >
            <option value="">Ch·ªçn Tour</option>
          </select>
          <input
            type="text"
            name="airline"
            placeholder="H√£ng bay"
            class="p-2 border rounded"
            required
          />
          <input
            type="text"
            name="departurePoint"
            placeholder="ƒêi·ªÉm ƒëi"
            class="p-2 border rounded"
            required
          />
          <input
            type="text"
            name="destinationPoint"
            placeholder="ƒêi·ªÉm ƒë·∫øn"
            class="p-2 border rounded"
            required
          />
          <input
            type="number"
            name="flightPrice"
            placeholder="Gi√° v√©"
            class="p-2 border rounded"
            required
          />
          <input
            type="datetime-local"
            name="departTime"
            class="p-2 border rounded"
            required
          />
          <input
            type="datetime-local"
            name="returnTime"
            class="p-2 border rounded"
            placeholder="Ng√†y gi·ªù v·ªÅ"
            required
          />
          <button
            type="submit"
            class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded col-span-1 md:col-span-2"
          >
            ‚ûï Th√™m V√© m√°y bay
          </button>
        </form>
        <div id="flightList" class="space-y-2"></div>
        </div>
      </section>
    </main>

    <!-- Script -->
    <script>
      let selectedTourID = null;

      // Chuy·ªÉn tab
      document.querySelectorAll(".tab-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          const tab = btn.dataset.tab;
          document
            .querySelectorAll(".tab-content")
            .forEach((sec) => sec.classList.add("hidden"));
          document.getElementById(tab).classList.remove("hidden");
        });
      });

      // Th√™m Tour
      document
        .getElementById("addTourForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const formData = new FormData(e.target);
          const messageBox = document.getElementById("tourMessage");

          try {
            const res = await fetch("/provider/add-tour", {
              method: "POST",
              body: formData,
            });

            const text = await res.text();
            console.log(text);

            messageBox.classList.remove("hidden");
            if (res.ok) {
              messageBox.innerText = " Th√™m tour th√†nh c√¥ng!";
              messageBox.className =
                "text-green-600 font-semibold col-span-1 md:col-span-2";
              e.target.reset();
              fetchTours(); // Load l·∫°i danh s√°ch
            } else {
              messageBox.innerText = " Th√™m tour th·∫•t b·∫°i.";
              messageBox.className =
                "text-red-600 font-semibold col-span-1 md:col-span-2";
            }
          } catch (error) {
            console.error(error);
            messageBox.innerText = " Kh√¥ng th·ªÉ k·∫øt n·ªëi server.";
            messageBox.className =
              "text-red-600 font-semibold col-span-1 md:col-span-2";
          }
        });

      // Load danh s√°ch tour
      async function fetchTours() {
        try {
          const res = await fetch("/provider/tours");
          const tours = await res.json();
          const tourList = document.getElementById("tourList");
          tourList.innerHTML = "";

          tours.forEach((tour) => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td class="border px-4 py-2">${tour.TourName}</td>
              <td class="border px-4 py-2">${tour.Destination}</td>
              <td class="border px-4 py-2">${tour.Price}</td>
              <td class="border px-4 py-2">${tour.SoCho}</td>
              <td class="border px-4 py-2">
                <img src="${tour.ImageURL}" alt="Tour Image" class="w-16 h-16 object-cover rounded">
              </td>
              <td class="border px-4 py-2">
                <button class="edit-tour-btn bg-yellow-500 hover:bg-yellow-600 text-white py-1 px-2 rounded mr-2" data-id="${tour.TourID}">Ch·ªânh s·ª≠a</button>
                <button class="delete-tour-btn bg-red-500 hover:bg-red-600 text-white py-1 px-2 rounded" data-id="${tour.TourID}">X√≥a</button>
                <button class="view-tour-btn bg-green-500 hover:bg-green-600 text-white py-1 px-2 rounded mr-2" data-id="${tour.TourID}">Xem chi ti·∫øt</button>
              </td>
            `;
            tourList.appendChild(row);
          });
        } catch (error) {
          console.error("L·ªói khi load tour:", error);
        }
      }
      fetchTours();

      // Th√™m modal hi·ªÉn th·ªã chi ti·∫øt tour
      const modalHTML = `
        <div id="tourDetailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
          <div class="bg-white p-6 rounded-lg w-3/4 max-h-[80vh] overflow-y-auto relative">
            <h2 class="text-2xl font-bold mb-4">Chi ti·∫øt Tour</h2>
            <button id="closeTourDetailModal" class="absolute top-4 right-4 text-gray-600 hover:text-gray-900 text-2xl font-bold">&times;</button>
            <div id="tourDetailContent" class="space-y-4">
              <!-- N·ªôi dung chi ti·∫øt s·∫Ω ƒë∆∞·ª£c ch√®n ·ªü ƒë√¢y -->
            </div>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML("beforeend", modalHTML);

      // H√†m format ng√†y gi·ªù
      function formatDateTime(dateStr) {
        const date = new Date(dateStr);
        if (isNaN(date)) return "";
        return date.toLocaleString("vi-VN", {
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit",
        });
      }

      // X·ª≠ l√Ω click n√∫t xem chi ti·∫øt
      document.addEventListener("click", async (e) => {
        if (e.target.classList.contains("view-tour-btn")) {
          const tourID = e.target.dataset.id;
          try {
            const res = await fetch(`/provider/tour-details/${tourID}`);
            if (!res.ok) {
              alert("L·ªói khi l·∫•y chi ti·∫øt tour");
              return;
            }
            const data = await res.json();
            const { tour, hotels, flights } = data;

            let html = `
              <h3 class="text-xl font-semibold">Th√¥ng tin Tour</h3>
              <p><strong>T√™n tour:</strong> ${tour.TourName}</p>
              <p><strong>ƒêi·ªÉm ƒë·∫øn:</strong> ${tour.Destination}</p>
              <p><strong>Gi√°:</strong> ${tour.Price}</p>
              <p><strong>S·ªë ch·ªó:</strong> ${tour.SoCho}</p>
              <img src="${tour.ImageURL}" alt="·∫¢nh tour" class="w-48 h-32 object-cover rounded mt-2" />
              <hr class="my-4" />
              <h3 class="text-xl font-semibold">Kh√°ch s·∫°n</h3>
            `;

            if (hotels.length === 0) {
              html += "<p>Ch∆∞a c√≥ kh√°ch s·∫°n n√†o.</p>";
            } else {
              html += `<ul class="space-y-2">`;
              hotels.forEach((hotel) => {
                html += `
                  <li class="border p-2 rounded flex gap-4 items-center">
                    <img src="${hotel.ImageURL}" alt="·∫¢nh kh√°ch s·∫°n" class="w-24 h-16 object-cover rounded" />
                    <div>
                      <p><strong>${hotel.HotelName}</strong></p>
                      <p>V·ªã tr√≠: ${hotel.Location}</p>
                      <p>Gi√°/ƒë√™m: ${hotel.PricePerNight}</p>
                    </div>
                  </li>
                `;
              });
              html += `</ul>`;
            }

            html += `<hr class="my-4" /><h3 class="text-xl font-semibold">V√© m√°y bay</h3>`;

            if (flights.length === 0) {
              html += "<p>Ch∆∞a c√≥ v√© m√°y bay n√†o.</p>";
            } else {
              html += `<ul class="space-y-2">`;
              flights.forEach((flight) => {
                html += `
                  <li class="border p-2 rounded">
                    <p><strong>H√£ng bay:</strong> ${flight.Airline}</p>
                    <p><strong>ƒêi·ªÉm ƒëi:</strong> ${flight.DeparturePoint}</p>
                    <p><strong>ƒêi·ªÉm ƒë·∫øn:</strong> ${flight.DestinationPoint}</p>
                    <p><strong>Gi√° v√©:</strong> ${flight.Price}</p>
                    <p><strong>Ng√†y gi·ªù kh·ªüi h√†nh:</strong> ${formatDateTime(flight.DepartureDate)}</p>
                  </li>
                `;
              });
              html += `</ul>`;
            }

            document.getElementById("tourDetailContent").innerHTML = html;
            document.getElementById("tourDetailModal").classList.remove("hidden");
          } catch (err) {
            console.error("L·ªói khi l·∫•y chi ti·∫øt tour:", err);
            alert("L·ªói khi l·∫•y chi ti·∫øt tour");
          }
        }
      });

      // Th√™m modal hi·ªÉn th·ªã chi ti·∫øt tour
      if (!document.getElementById("tourDetailModal")) {
        const modalHTML = `
          <div id="tourDetailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg w-3/4 max-h-[80vh] overflow-y-auto relative">
              <h2 class="text-2xl font-bold mb-4">Chi ti·∫øt Tour</h2>
              <button id="closeTourDetailModal" class="absolute top-4 right-4 text-gray-600 hover:text-gray-900 text-2xl font-bold">&times;</button>
              <div id="tourDetailContent" class="space-y-4">
                <!-- N·ªôi dung chi ti·∫øt s·∫Ω ƒë∆∞·ª£c ch√®n ·ªü ƒë√¢y -->
              </div>
            </div>
          </div>
        `;
        document.body.insertAdjacentHTML("beforeend", modalHTML);
      }

      // H√†m format ng√†y gi·ªù
      function formatDateTime(dateStr) {
        const date = new Date(dateStr);
        if (isNaN(date)) return "";
        return date.toLocaleString("vi-VN", {
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit",
        });
      }

      // X·ª≠ l√Ω click n√∫t xem chi ti·∫øt
      document.addEventListener("click", async (e) => {
        if (e.target.classList.contains("view-tour-btn")) {
          const tourID = e.target.dataset.id;
          try {
            const res = await fetch(`/provider/tour-details/${tourID}`);
            if (!res.ok) {
              alert("L·ªói khi l·∫•y chi ti·∫øt tour");
              return;
            }
            const data = await res.json();
            const { tour, hotels, flights } = data;

            let html = `
              <h3 class="text-xl font-semibold">Th√¥ng tin Tour</h3>
              <p><strong>T√™n tour:</strong> ${tour.TourName}</p>
              <p><strong>ƒêi·ªÉm ƒë·∫øn:</strong> ${tour.Destination}</p>
              <p><strong>Gi√°:</strong> ${tour.Price}</p>
              <p><strong>S·ªë ch·ªó:</strong> ${tour.SoCho}</p>
              <img src="${tour.ImageURL}" alt="·∫¢nh tour" class="w-48 h-32 object-cover rounded mt-2" />
              <hr class="my-4" />
              <h3 class="text-xl font-semibold">Kh√°ch s·∫°n</h3>
            `;

            if (hotels.length === 0) {
              html += "<p>Ch∆∞a c√≥ kh√°ch s·∫°n n√†o.</p>";
            } else {
              html += `<ul class="space-y-2">`;
              hotels.forEach((hotel) => {
                html += `
                  <li class="border p-2 rounded flex gap-4 items-center">
                    <img src="${hotel.ImageURL}" alt="·∫¢nh kh√°ch s·∫°n" class="w-24 h-16 object-cover rounded" />
                    <div>
                      <p><strong>${hotel.HotelName}</strong></p>
                      <p>V·ªã tr√≠: ${hotel.Location}</p>
                      <p>Gi√°/ƒë√™m: ${hotel.PricePerNight}</p>
                    </div>
                  </li>
                `;
              });
              html += `</ul>`;
            }

            html += `<hr class="my-4" /><h3 class="text-xl font-semibold">V√© m√°y bay</h3>`;

            if (flights.length === 0) {
              html += "<p>Ch∆∞a c√≥ v√© m√°y bay n√†o.</p>";
            } else {
              html += `<ul class="space-y-2">`;
              flights.forEach((flight) => {
                html += `
                  <li class="border p-2 rounded">
                    <p><strong>H√£ng bay:</strong> ${flight.Airline}</p>
                    <p><strong>ƒêi·ªÉm ƒëi:</strong> ${flight.DeparturePoint}</p>
                    <p><strong>ƒêi·ªÉm ƒë·∫øn:</strong> ${flight.DestinationPoint}</p>
                    <p><strong>Gi√° v√©:</strong> ${flight.Price}</p>
                    <p><strong>Ng√†y gi·ªù kh·ªüi h√†nh:</strong> ${formatDateTime(flight.DepartureDate)}</p>
                  </li>
                `;
              });
              html += `</ul>`;
            }

            document.getElementById("tourDetailContent").innerHTML = html;
            document.getElementById("tourDetailModal").classList.remove("hidden");
          } catch (err) {
            console.error("L·ªói khi l·∫•y chi ti·∫øt tour:", err);
            alert("L·ªói khi l·∫•y chi ti·∫øt tour");
          }
        }
      });

      // ƒê√≥ng modal
      document.addEventListener("click", (e) => {
        if (e.target.id === "closeTourDetailModal" || e.target.id === "tourDetailModal") {
          document.getElementById("tourDetailModal").classList.add("hidden");
        }
      });

      // Ch·ªânh s·ª≠a tour
      document.addEventListener("click", (e) => {
        if (e.target.classList.contains("edit-tour-btn")) {
          selectedTourID = e.target.dataset.id;
          const row = e.target.closest("tr");
          document.getElementById("editTourName").value =
            row.children[0].innerText;
          document.getElementById("editDestination").value =
            row.children[1].innerText;
          document.getElementById("editPrice").value =
            row.children[2].innerText;
          document.getElementById("editSeats").value =
            row.children[3].innerText;
          // TODO: Need to fetch and fill the new fields for editing
          // For now, clear the new fields
          document.getElementById("editDiemThamQuan").value = "";
          document.getElementById("editAmThuc").value = "";
          document.getElementById("editDoiTuongThichHop").value = "";
          document.getElementById("editThoiGianLyTuong").value = "";
          document.getElementById("editPhuongTien").value = "";
          document.getElementById("editKhuyenMai").value = "";
          document.getElementById("editTourModal").classList.remove("hidden");
        }
      });

      document.getElementById("cancelEdit").addEventListener("click", () => {
        document.getElementById("editTourModal").classList.add("hidden");
      });

      document
        .getElementById("editTourForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          try {
            const res = await fetch(`/provider/edit-tour/${selectedTourID}`, {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                tourName: document.getElementById("editTourName").value,
                destination: document.getElementById("editDestination").value,
                price: document.getElementById("editPrice").value,
                seats: document.getElementById("editSeats").value,
                diemThamQuan: document.getElementById("editDiemThamQuan").value,
                amThuc: document.getElementById("editAmThuc").value,
                doiTuongThichHop: document.getElementById("editDoiTuongThichHop").value,
                thoiGianLyTuong: document.getElementById("editThoiGianLyTuong").value,
                phuongTien: document.getElementById("editPhuongTien").value,
                khuyenMai: document.getElementById("editKhuyenMai").value,
              }),
            });

            const text = await res.text();
            console.log(text);

            if (res.ok) {
              alert("‚úÖ C·∫≠p nh·∫≠t th√†nh c√¥ng!");
              document.getElementById("editTourModal").classList.add("hidden");
              fetchTours();
            } else {
              alert("‚ùå Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t tour.");
            }
          } catch (err) {
            console.error("L·ªói ch·ªânh s·ª≠a tour:", err);
          }
        });

      // X√≥a tour
      document.addEventListener("click", async (e) => {
        if (e.target.classList.contains("delete-tour-btn")) {
          const id = e.target.dataset.id;
          if (confirm("B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a tour n√†y?")) {
            try {
              const res = await fetch(`/provider/delete-tour/${id}`, {
                method: "DELETE",
              });
              const text = await res.text();
              console.log(text);

              if (res.ok) {
                alert("ƒê√£ x√≥a th√†nh c√¥ng!");
                fetchTours();
              } else {
                alert("‚ùå X√≥a th·∫•t b·∫°i.");
              }
            } catch (error) {
              console.error("L·ªói khi x√≥a:", error);
            }
          }
        }
      });

      document.querySelectorAll(".sub-tab-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          document
            .querySelectorAll(".sub-tab")
            .forEach((tab) => tab.classList.add("hidden"));
          const id = btn.dataset.subtab;
          document.getElementById(id).classList.remove("hidden");
        });
      });

      // G·ª≠i kh√°ch s·∫°n
      document
        .getElementById("hotelForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const formData = new FormData(e.target);
          try {
            const tourID = document.getElementById("hotelTourSelect").value;
            if (!tourID) {
              alert("Vui l√≤ng ch·ªçn tour cho kh√°ch s·∫°n.");
              return;
            }
            formData.append("tourID", tourID);
            const res = await fetch("/provider/add-hotel", {
              method: "POST",
              body: formData,
            });
            const result = await res.text();
            alert(result);
            e.target.reset();
          } catch (err) {
            console.error(err);
            alert("‚ùå L·ªói khi th√™m kh√°ch s·∫°n.");
          }
        });

      // G·ª≠i v√© m√°y bay
        document
        .getElementById("flightForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
        const formData = new FormData(e.target);
        try {
          const tourID = document.getElementById("flightTourSelect").value;
          if (!tourID) {
            alert("Vui l√≤ng ch·ªçn tour cho v√© m√°y bay.");
            return;
          }
          formData.append("tourID", tourID);
          // Th√™m c√°c tr∆∞·ªùng departurePoint, destinationPoint, flightPrice, departTime, returnTime v√†o formData
          const departurePoint = e.target.querySelector('input[name="departurePoint"]').value;
          const destinationPoint = e.target.querySelector('input[name="destinationPoint"]').value;
          const flightPrice = e.target.querySelector('input[name="flightPrice"]').value;
          const departTime = e.target.querySelector('input[name="departTime"]').value;
          const returnTime = e.target.querySelector('input[name="returnTime"]').value;
          formData.append("departurePoint", departurePoint);
          formData.append("destinationPoint", destinationPoint);
          formData.append("flightPrice", flightPrice);
          formData.append("departTime", departTime);
          formData.append("returnTime", returnTime);
          const res = await fetch("/provider/add-flight", {
            method: "POST",
            body: formData,
          });
          const result = await res.text();
          alert(result);
          e.target.reset();
        } catch (err) {
          console.error(err);
          alert("‚ùå L·ªói khi th√™m v√© m√°y bay.");
        }
      });
    </script>
    <script>
      // Load tours for dropdowns
      async function loadProviderTours() {
        try {
          const res = await fetch("/provider/tours");
          const tours = await res.json();

          const hotelSelect = document.getElementById("hotelTourSelect");
          const flightSelect = document.getElementById("flightTourSelect");

          tours.forEach((tour) => {
            const option1 = document.createElement("option");
            option1.value = tour.TourID;
            option1.textContent = tour.TourName;
            hotelSelect.appendChild(option1);

            const option2 = document.createElement("option");
            option2.value = tour.TourID;
            option2.textContent = tour.TourName;
            flightSelect.appendChild(option2);
          });
        } catch (error) {
          console.error("L·ªói khi t·∫£i danh s√°ch tour:", error);
        }
      }
      loadProviderTours();
    </script>
  </body>
</html>
